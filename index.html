<!DOCTYPE html>
<html>
<head>
  <title>Shared Budget Tracker</title>
  <style>
    body {
      font-family: sans-serif;
      margin: 0;
      background: linear-gradient(to bottom right, #fce4ec, #e3f2fd);
    }
    .container {
      display: flex;
      flex-direction: column;
      padding: 10px;
    }
    .top-row {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
    }
    .left-pane {
      flex: 1;
      padding: 10px;
    }
    .center-pane {
      flex: 1;
      padding: 10px;
    }
    .right-pane {
      flex: 1;
      padding: 10px;
    }
    .over-budget { color: red; font-weight: bold; }
    .log-item { margin-bottom: 4px; }
    .groceries { color: green; }
    .dining { color: orange; }
    .shopping { color: blue; }
    select, input, button {
      padding: 8px;
      border-radius: 6px;
      border: 1px solid #ccc;
      margin: 5px 0;
    }
    button { background: #d1c4e9; cursor: pointer; }
    button:hover { background: #b39ddb; }
    canvas { background: white; margin-top: 20px; }
    .tabs button {
      margin-right: 5px;
      padding: 6px 10px;
    }
  </style>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
  <div class="container">
    <div class="top-row">
      <div class="left-pane">
        <div class="tabs">
          <button onclick="selectUser('Sean')">Sean</button>
          <button onclick="selectUser('McKenna')">McKenna</button>
        </div>
        <label>Category:</label>
        <select id="category">
          <option value="groceries">Groceries</option>
          <option value="dining">Dining Out</option>
          <option value="shopping">Shopping</option>
        </select><br>

        <label>Amount:</label><br>
        <input type="number" id="amount" /><br>

        <button onclick="addExpense()">Add Expense</button>
      </div>

      <div class="center-pane">
        <h3>Monthly & Yearly Budget</h3>
        <div id="monthlySummary"></div>
        <div id="yearlySummary"></div>
        <canvas id="userChart" width="300" height="200"></canvas>
      </div>

      <div class="right-pane">
        <h3>Expenses (<span id="filterLabel">All</span>)</h3>
        <button onclick="filterByType('all')">All</button>
        <button onclick="filterByType('groceries')">Groceries</button>
        <button onclick="filterByType('dining')">Dining Out</button>
        <button onclick="filterByType('shopping')">Shopping</button>
        <ul id="expenseList"></ul>
      </div>
    </div>
  </div>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyCKy1KVoLdTH_nwpYVr8u_CT5e0hjBpFOc",
      authDomain: "truth-b65cd.firebaseapp.com",
      databaseURL: "https://truth-b65cd-default-rtdb.firebaseio.com",
      projectId: "truth-b65cd",
      storageBucket: "truth-b65cd.firebasestorage.app",
      messagingSenderId: "11180463959",
      appId: "1:11180463959:web:e860d37bdbf8e245e25012",
      measurementId: "G-HPYS4F4MYJ"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    const expenseRef = db.ref("expenses");
    let selectedUser = "Sean";

    const budgets = {
      groceries: 500,
      dining: 180,
      shopping: 125
    };

    function getCurrentMonth() {
      const now = new Date();
      return `${now.getFullYear()}-${String(now.getMonth() + 1).padStart(2, '0')}`;
    }

    function selectUser(user) {
      selectedUser = user;
    }

    function addExpense() {
      const category = document.getElementById("category").value;
      const amount = parseFloat(document.getElementById("amount").value);
      const month = getCurrentMonth();
      if (!amount || amount <= 0) return alert("Enter a valid amount");
      const expense = { who: selectedUser, category, amount, month, timestamp: Date.now() };
      expenseRef.push(expense);
    }

    function filterByType(type) {
      document.getElementById("filterLabel").innerText = type === "all" ? "All" : type;
      loadExpenses(type);
    }

    function deleteExpense(key) {
      if (confirm("Delete this expense?")) {
        db.ref("expenses/" + key).remove();
      }
    }

    function editExpense(key, oldData) {
      const newAmount = prompt("Enter new amount:", oldData.amount);
      if (newAmount && !isNaN(newAmount)) {
        db.ref("expenses/" + key).update({ amount: parseFloat(newAmount) });
      }
    }

    function loadExpenses(filter = "all") {
      expenseRef.orderByChild("timestamp").once("value", snapshot => {
        const list = document.getElementById("expenseList");
        list.innerHTML = "";

        const currentMonth = getCurrentMonth();
        const totals = { groceries: 0, dining: 0, shopping: 0 };
        const yearlyTotals = { groceries: 0, dining: 0, shopping: 0 };
        const userTotals = { Sean: 0, McKenna: 0 };
        const year = new Date().getFullYear();

        snapshot.forEach(child => {
          const data = child.val();
          const key = child.key;

          if (data.month.startsWith(year)) {
            yearlyTotals[data.category] += data.amount;
            if (data.month === currentMonth) {
              totals[data.category] += data.amount;
              userTotals[data.who] += data.amount;
            }

            if (filter === "all" || data.category === filter) {
              const li = document.createElement("li");
              li.className = `log-item ${data.category}`;
              li.innerHTML = `${data.who} spent $${data.amount.toFixed(2)} on ${data.category} (${data.month}) ` +
                `<button onclick="editExpense('${key}', ${JSON.stringify(data)})">‚úèÔ∏è</button>` +
                ` <button onclick="deleteExpense('${key}')">üóëÔ∏è</button>`;
              list.appendChild(li);
            }
          }
        });

        const monthlySummary = document.getElementById("monthlySummary");
        monthlySummary.innerHTML = "";
        for (let cat in budgets) {
          const remaining = budgets[cat] - totals[cat];
          const over = remaining < 0 ? " over-budget" : "";
          monthlySummary.innerHTML += `<p class="${cat}${over}">${cat.charAt(0).toUpperCase() + cat.slice(1)}: $${remaining.toFixed(2)} left this month</p>`;
        }

        const yearlySummary = document.getElementById("yearlySummary");
        yearlySummary.innerHTML = "";
        for (let cat in budgets) {
          const yearlyLimit = budgets[cat] * 12;
          const remaining = yearlyLimit - yearlyTotals[cat];
          yearlySummary.innerHTML += `<p class="${cat}">${cat.charAt(0).toUpperCase() + cat.slice(1)}: $${remaining.toFixed(2)} left this year</p>`;
        }

        renderChart(userTotals);
      });
    }

    function renderChart(userTotals) {
      const ctx = document.getElementById('userChart').getContext('2d');
      if (window.userChart) window.userChart.destroy();
      window.userChart = new Chart(ctx, {
        type: 'bar',
        data: {
          labels: Object.keys(userTotals),
          datasets: [{
            label: 'Total Spent This Month',
            data: Object.values(userTotals),
            backgroundColor: ['#ce93d8', '#90caf9']
          }]
        },
        options: {
          responsive: true,
          plugins: {
            legend: { display: false }
          },
          scales: {
            y: { beginAtZero: true }
          }
        }
      });
    }

    loadExpenses();
  </script>
</body>
</html>

