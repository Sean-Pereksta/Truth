<!DOCTYPE html>
<html>
<head>
  <title>Shared Budget Tracker</title>
  <style>
    body { font-family: sans-serif; margin: 20px; }
    .over-budget { color: red; font-weight: bold; }
    .log-item { margin-bottom: 4px; }
    .groceries { color: green; }
    .dining { color: orange; }
    .shopping { color: blue; }
  </style>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
</head>
<body>
  <h2>Shared Budget Tracker</h2>

  <label>Who:</label>
  <select id="who">
    <option value="Sean">Sean</option>
    <option value="McKenna">McKenna</option>
  </select><br><br>

  <label>Category:</label>
  <select id="category">
    <option value="groceries">Groceries</option>
    <option value="dining">Dining Out</option>
    <option value="shopping">Shopping</option>
  </select><br><br>

  <label>Amount:</label>
  <input type="number" id="amount" /><br><br>

  <button onclick="addExpense()">Add Expense</button>

  <h3>Remaining Monthly Budget</h3>
  <div id="monthlySummary"></div>

  <h3>Remaining Yearly Budget</h3>
  <div id="yearlySummary"></div>

  <h3>Expenses (<span id="filterLabel">All</span>)</h3>
  <button onclick="filterByType('all')">All</button>
  <button onclick="filterByType('groceries')">Groceries</button>
  <button onclick="filterByType('dining')">Dining Out</button>
  <button onclick="filterByType('shopping')">Shopping</button>
  <ul id="expenseList"></ul>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyB7twY7z31ucB6pGA8JC_HrVMZhA8lNaJA",
      authDomain: "bible-game-246c0.firebaseapp.com",
      databaseURL: "https://bible-game-246c0-default-rtdb.firebaseio.com",
      projectId: "bible-game-246c0",
      storageBucket: "bible-game-246c0.appspot.com",
      messagingSenderId: "959619818996",
      appId: "1:959619818996:web:5a9fbf492e23c765e445a1"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    const expenseRef = db.ref("expenses");

    const budgets = {
      groceries: 500,
      dining: 180,
      shopping: 125
    };

    function getCurrentMonth() {
      const now = new Date();
      return `${now.getFullYear()}-${String(now.getMonth() + 1).padStart(2, '0')}`;
    }

    function addExpense() {
      const who = document.getElementById("who").value;
      const category = document.getElementById("category").value;
      const amount = parseFloat(document.getElementById("amount").value);
      const month = getCurrentMonth();
      if (!amount || amount <= 0) return alert("Enter a valid amount");
      const expense = { who, category, amount, month, timestamp: Date.now() };
      expenseRef.push(expense);
    }

    function filterByType(type) {
      document.getElementById("filterLabel").innerText = type === "all" ? "All" : type;
      loadExpenses(type);
    }

    function deleteExpense(key) {
      if (confirm("Delete this expense?")) {
        db.ref("expenses/" + key).remove();
      }
    }

    function editExpense(key, oldData) {
      const newAmount = prompt("Enter new amount:", oldData.amount);
      if (newAmount && !isNaN(newAmount)) {
        db.ref("expenses/" + key).update({ amount: parseFloat(newAmount) });
      }
    }

    function loadExpenses(filter = "all") {
      expenseRef.orderByChild("timestamp").once("value", snapshot => {
        const list = document.getElementById("expenseList");
        list.innerHTML = "";

        const currentMonth = getCurrentMonth();
        const totals = { groceries: 0, dining: 0, shopping: 0 };
        const yearlyTotals = { groceries: 0, dining: 0, shopping: 0 };
        const year = new Date().getFullYear();

        snapshot.forEach(child => {
          const data = child.val();
          const key = child.key;

          if (data.month.startsWith(year)) {
            yearlyTotals[data.category] += data.amount;
            if (data.month === currentMonth) {
              totals[data.category] += data.amount;
            }

            if (filter === "all" || data.category === filter) {
              const li = document.createElement("li");
              li.className = `log-item ${data.category}`;
              li.innerHTML = `${data.who} spent $${data.amount.toFixed(2)} on ${data.category} (${data.month}) ` +
                `<button onclick="editExpense('${key}', ${JSON.stringify(data)})">‚úèÔ∏è</button>` +
                ` <button onclick="deleteExpense('${key}')">üóëÔ∏è</button>`;
              list.appendChild(li);
            }
          }
        });

        const monthlySummary = document.getElementById("monthlySummary");
        monthlySummary.innerHTML = "";
        for (let cat in budgets) {
          const remaining = budgets[cat] - totals[cat];
          const over = remaining < 0 ? " over-budget" : "";
          monthlySummary.innerHTML += `<p class="${cat}${over}">${cat.charAt(0).toUpperCase() + cat.slice(1)}: $${remaining.toFixed(2)} left this month</p>`;
        }

        const yearlySummary = document.getElementById("yearlySummary");
        yearlySummary.innerHTML = "";
        for (let cat in budgets) {
          const yearlyLimit = budgets[cat] * 12;
          const remaining = yearlyLimit - yearlyTotals[cat];
          yearlySummary.innerHTML += `<p class="${cat}">${cat.charAt(0).toUpperCase() + cat.slice(1)}: $${remaining.toFixed(2)} left this year</p>`;
        }
      });
    }

    loadExpenses();
  </script>
</body>
</html>

